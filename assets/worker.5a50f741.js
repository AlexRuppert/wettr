!function(){"use strict";const t={light:"#444444",dark:"#9ca3aa"},e={light:"#0066ED",dark:"#2784FF"},n={light:"#FFB901",dark:"#FFC637"},r=r=>{switch(r){case"rain":case"sleet":case"hail":case"snow":case"thunderstorm":return e;case"clearDay":case"clearNight":case"partlyCloudyDay":case"partlyCloudyNight":return n;default:return t}},a="x--cache-timestamp";async function o(t,e=1e6){let n=await caches.match(t);if(n&&n.headers.get(a)&&+n.headers.get(a)+6e4*e>Date.now())return console.log("cached "+t),n;n=await fetch(t);const r=new Headers(n.headers);r.set(a,Date.now().toString());const o=n.clone(),i=new Response(o.body,{status:o.status,statusText:o.statusText,headers:r});return(await caches.open("v1")).put(t,i),n}const i="https://api.brightsky.dev/";let u=new URL(i+"current_weather"),s=new URL(i+"weather");function c(t){return t.replace(/-\w/g,(t=>t.replace(/-/,"").toUpperCase()))}function l(t=new Date,e=!1){return new Intl.DateTimeFormat("eu").format(t).replace(/\//g,"-")+function(t=new Date,e=!1){return(e?"T23:59:00":"T00:00:00")+function(t=new Date){let e=-t.getTimezoneOffset();const n=t=>{const e=Math.floor(Math.abs(t));return(10>e?"0":"")+e};return(0>e?"-":"+")+n(e/60)+":"+n(e%60)}(t)}(t,e)}async function f(t,e,n=3){const a=new Date,i=new Date(a.getTime()+864e5*n-10);s.search=new URLSearchParams({lat:t.toFixed(3),lon:e.toFixed(3),days:n.toString(),date:l(a),last_date:l(i,!0)}).toString();const u=function(t,e,n){const a=t.weather.map((t=>({timestamp:t.timestamp,cloudCover:t.cloud_cover,condition:t.condition,dewPoint:t.dew_point,precipitation:t.precipitation,pressureMsl:t.pressure_msl,relativeHumidity:t.relative_humidity,visibility:t.visibility,windDirection:t.wind_direction,windSpeed:t.wind_speed,windGustDirection:t.wind_gust_direction,windGustSpeed:t.wind_gust_speed,sunshine:t.sunshine,temperature:Math.round(t.temperature),icon:c(t.icon)}))),o={};a.forEach((t=>{const e=t.timestamp.split("T")[0];o[e]||(o[e]=[]),o[e].push(t)}));let i={};const u=(t,e,n)=>t>=e&&n>=t,s=t=>{let e=-1/0,n=1/0;t.forEach((t=>{t.temperature>e&&(e=t.temperature),n>t.temperature&&(n=t.temperature)}));const r=e-n;return{min:{temperature:n},max:{temperature:e},dayGraph:t.map((t=>({timestamp:t.timestamp,temperature:0===r?0:Math.abs((t.temperature-n)/r),precipitation:Math.min(Math.pow(1.7*Math.sqrt(t.precipitation),2),6)/6,sunniness:1-t.cloudCover/100})))}};return Object.entries(o).map((([t,a])=>{a=a.map((t=>{return{...t,hours:(e=t.timestamp,new Date(e).getHours())};var e}));const o=new Date(t),c=[],l=[],f=[],d=[],p=function(t,e,n){const r=new Date(t.toISOString().substr(0,10)+"T12:00Z");function a(t){return Math.sin(t*(Math.PI/180))}function o(t){return Math.cos(t*(Math.PI/180))}function i(t){return new Date(864e5*(t-2440587.5))}const u=Math.floor(r.getTime()/864e5+2440587.5)-2451545+8e-4-n/360,s=(357.5291+.98560028*u)%360,c=(s+(1.9148*a(s)+.02*a(2*s)+3e-4*a(3*s))+180+102.9372)%360,l=2451545+u+.0053*a(s)-.0069*a(2*c),f=(d=a(c)*a(23.44),Math.asin(d)*(180/Math.PI));var d;const p=function(t){return Math.acos(t)*(180/Math.PI)}((a(-.83)-a(e)*a(f))/(o(e)*o(f)));return{sunrise:i(l-p/360),sunset:i(l+p/360)}}(o,e,n);return a.forEach((t=>{u(t.hours,4,22)&&c.push(t),u(t.hours,4,9)&&l.push(t),u(t.hours,10,17)&&f.push(t),u(t.hours,18,22)&&d.push(t)})),{day:o,dayLight:p,dayParts:[l,f,d].map((t=>{const e=(i={},t.forEach((t=>{var e;return i[t.icon]=(t=>{switch(t){case"thunderstorm":case"hail":return 12;default:return 1}})(t.icon)+(null!=(e=i[t.icon])?e:0)})),Object.entries(i).reduce(((t,[e,n])=>n>t[1]?[e,n]:t),["clear-day",0])[0].replace("Night","Day"));return{icon:e,colors:r(e)}})),...s(c),data:a}}))}(await(await o(s.toString(),9)).json(),t,e);return u}function d(t,e){var n=t.length;if(n>=e)return t;var r=new Uint8Array(Math.max(n<<1,e));return r.set(t,0),r}function p(t,e,n,r,a,o){for(var i=g,u=_,s=0;n>s;){var c=t[u(r,a)&e];a+=15&c;var l=c>>>4;if(l>15){var f=0,d=0;16==l?(d=3+i(r,a,2),a+=2,f=o[s-1]):17==l?(d=3+i(r,a,3),a+=3):18==l&&(d=11+i(r,a,7),a+=7);for(var p=s+d;p>s;)o[s]=f,s++}else o[s]=l,s++}return a}function h(t,e,n,r){for(var a=0,o=0,i=r.length>>>1;n>o;){var u=t[o+e];r[o<<1]=0,r[1+(o<<1)]=u,u>a&&(a=u),o++}for(;i>o;)r[o<<1]=0,r[1+(o<<1)]=0,o++;return a}function v(t,e){for(var n,r,a,o,i=t.length,u=b.bl_count,s=0;e>=s;s++)u[s]=0;for(s=1;i>s;s+=2)u[t[s]]++;var c=b.next_code;for(n=0,u[0]=0,r=1;e>=r;r++)c[r]=n=n+u[r-1]<<1;for(a=0;i>a;a+=2)0!=(o=t[a+1])&&(t[a]=c[o],c[o]++)}function w(t,e,n){for(var r=t.length,a=b.rev15,o=0;r>o;o+=2)if(0!=t[o+1])for(var i=t[o+1],u=o>>1<<4|i,s=e-i,c=t[o]<<s,l=c+(1<<s);c!=l;)n[a[c]>>>15-e]=u,c++}function m(t,e){for(var n=b.rev15,r=15-e,a=0;t.length>a;a+=2)t[a]=n[t[a]<<e-t[a+1]]>>>r}function g(t,e,n){return(t[e>>>3]|t[1+(e>>>3)]<<8)>>>(7&e)&(1<<n)-1}function y(t,e,n){return(t[e>>>3]|t[1+(e>>>3)]<<8|t[2+(e>>>3)]<<16)>>>(7&e)&(1<<n)-1}function _(t,e){return(t[e>>>3]|t[1+(e>>>3)]<<8|t[2+(e>>>3)]<<16)>>>(7&e)}const b=(M=Uint16Array,D=Uint32Array,{next_code:new M(16),bl_count:new M(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new M(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new D(32),flmap:new M(512),fltree:[],fdmap:new M(32),fdtree:[],lmap:new M(32768),ltree:[],ttree:[],dmap:new M(32768),dtree:[],imap:new M(512),itree:[],rev15:new M(32768),lhst:new D(286),dhst:new D(30),ihst:new D(19),lits:new D(15e3),strt:new M(65536),prev:new M(32768)});var M,D;!function(){for(var t=0;32768>t;t++){var e=t;b.rev15[t]=((e=(4278255360&(e=(4042322160&(e=(3435973836&(e=(2863311530&e)>>>1|(1431655765&e)<<1))>>>2|(858993459&e)<<2))>>>4|(252645135&e)<<4))>>>8|(16711935&e)<<8)>>>16|e<<16)>>>17}function n(t,e,n){for(;0!=e--;)t.push(0,n)}for(t=0;32>t;t++)b.ldef[t]=b.of0[t]<<3|b.exb[t],b.ddef[t]=b.df0[t]<<4|b.dxb[t];n(b.fltree,144,8),n(b.fltree,112,9),n(b.fltree,24,7),n(b.fltree,8,8),v(b.fltree,9),w(b.fltree,9,b.flmap),m(b.fltree,9),n(b.fdtree,32,5),v(b.fdtree,5),w(b.fdtree,5,b.fdmap),m(b.fdtree,5),n(b.itree,19,0),n(b.ltree,286,0),n(b.dtree,30,0),n(b.ttree,320,0)}();const S={table:function(){for(var t=new Uint32Array(256),e=0;256>e;e++){for(var n=e,r=0;8>r;r++)1&n?n=3988292384^n>>>1:n>>>=1;t[e]=n}return t}(),update:function(t,e,n,r){for(var a=0;r>a;a++)t=S.table[255&(t^e[n+a])]^t>>>8;return t},crc:function(t,e,n){return 4294967295^S.update(4294967295,t,e,n)}};const C=Math.PI/180;function E(t){return Math.log(Math.tan(x(t)/2+Math.PI/4))}function x(t){return t*C}function L(t,{lon:e,lat:n}){return{x:x(e-t.lb.lon),y:E(n)-E(t.lb.lat)}}function P(t){const e=[];return t.forEach((t=>{const n=t.lon_bucket,r=t.lat_bucket,a=(o=Uint8Array.from(atob(t.data).split("").map((t=>t.charCodeAt(0)))),function(t,e){return function(t,e){var n=Uint8Array;if(3==t[0]&&0==t[1])return e||new n(0);var r=y,a=g,o=p,i=_,u=null==e;u&&(e=new n(t.length>>>2<<3));for(var s,c,l=0,f=0,m=0,M=0,D=0,S=0,C=0,E=0,x=0;0==l;)if(l=r(t,x,1),f=r(t,x+1,2),x+=3,0!=f){if(u&&(e=d(e,E+(1<<17))),1==f&&(s=b.flmap,c=b.fdmap,S=511,C=31),2==f){m=a(t,x,5)+257,M=a(t,x+5,5)+1,D=a(t,x+10,4)+4,x+=14;for(var L=0;38>L;L+=2)b.itree[L]=0,b.itree[L+1]=0;var P=1;for(L=0;D>L;L++){var I=a(t,x+3*L,3);b.itree[1+(b.ordr[L]<<1)]=I,I>P&&(P=I)}x+=3*D,v(b.itree,P),w(b.itree,P,b.imap),s=b.lmap,c=b.dmap,x=o(b.imap,(1<<P)-1,m+M,t,x,b.ttree);var U=h(b.ttree,0,m,b.ltree);S=(1<<U)-1;var A=h(b.ttree,m,M,b.dtree);C=(1<<A)-1,v(b.ltree,U),w(b.ltree,U,s),v(b.dtree,A),w(b.dtree,A,c)}for(;;){var T=s[i(t,x)&S];x+=15&T;var k=T>>>4;if(k>>>8==0)e[E++]=k;else{if(256==k)break;var F=E+k-254;if(k>264){var j=b.ldef[k-257];F=E+(j>>>3)+a(t,x,7&j),x+=7&j}var Z=c[i(t,x)&C],O=b.ddef[Z>>>4],$=(O>>>4)+r(t,x+=15&Z,15&O);for(x+=15&O,u&&(e=d(e,E+(1<<17)));F>E;)e[E]=e[E++-$],e[E]=e[E++-$],e[E]=e[E++-$],e[E]=e[E++-$];E=F}}}else{0!=(7&x)&&(x+=8-(7&x));var B=4+(x>>>3),G=t[B-4]|t[B-3]<<8;u&&(e=d(e,E+G)),e.set(new n(t.buffer,t.byteOffset+B,G),E),x=B+G<<3,E+=G}return e.length==E?e:e.slice(0,E)}(t,e)}(new Uint8Array(o.buffer,o.byteOffset+2,o.length-6),undefined));var o;let i=0;for(let u=0;a.length>u;u++){const o=a[u];128&o?i+=-129&o:(e.push({time:t.time,lon:n+i%100/100,lat:r+(i/100|0)/100,value:o/100}),i++)}})),e}function I(t,e){const n=new Date(t);return new Date(n.setMinutes(n.getMinutes()+e))}function U(t,e,n,r,a,o){var i=(o-e)*(n-t)-(r-e)*(a-t);return i>0||i>=0}function A(t){var e=[];t.forEach((function(t){var n=this.point2CellXY(t),r=n[0],a=n[1];void 0===e[r]&&(e[r]=[]),void 0===e[r][a]&&(e[r][a]=[]),e[r][a].push(t)}),this),this.cellPoints=function(t,n){return void 0!==e[t]&&void 0!==e[t][n]?e[t][n]:[]},this.removePoint=function(t){for(var n,r=this.point2CellXY(t),a=e[r[0]][r[1]],o=0;a.length>o;o++)if(a[o][0]===t[0]&&a[o][1]===t[1]){n=o;break}return a.splice(n,1),a}}A.prototype={point2CellXY:function(t){return[parseInt(t[0]/A.CELL_SIZE),parseInt(t[1]/A.CELL_SIZE)]},rangePoints:function(t){for(var e=this.point2CellXY([t[0],t[1]]),n=this.point2CellXY([t[2],t[3]]),r=[],a=e[0];n[0]>=a;a++)for(var o=e[1];n[1]>=o;o++)r=r.concat(this.cellPoints(a,o));return r},addBorder2Bbox:function(t,e){return[t[0]-e*A.CELL_SIZE,t[1]-e*A.CELL_SIZE,t[2]+e*A.CELL_SIZE,t[3]+e*A.CELL_SIZE]}},A.CELL_SIZE=10;var T=function(t,e){var n=t[0][0],r=t[0][1],a=t[1][0],o=t[1][1],i=e[0][0],u=e[0][1],s=e[1][0],c=e[1][1];return U(n,r,i,u,s,c)!==U(a,o,i,u,s,c)&&U(n,r,a,o,i,u)!==U(n,r,a,o,s,c)};function k(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(e[1]-t[1])*(n[0]-t[0])}function F(t,e){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)}function j(t,e,n){var r=[e[0]-t[0],e[1]-t[1]],a=[n[0]-t[0],n[1]-t[1]],o=F(t,e),i=F(t,n);return(r[0]*a[0]+r[1]*a[1])/Math.sqrt(o*i)}function Z(t,e){for(var n=0;e.length-1>n;n++){var r=[e[n],e[n+1]];if(!(t[0][0]===r[0][0]&&t[0][1]===r[0][1]||t[0][0]===r[1][0]&&t[0][1]===r[1][1])&&T(t,r))return!0}return!1}function O(t,e){var n,r,a,o;return t[1][0]>t[0][0]?(n=t[0][0]-e,r=t[1][0]+e):(n=t[1][0]-e,r=t[0][0]+e),t[1][1]>t[0][1]?(a=t[0][1]-e,o=t[1][1]+e):(a=t[1][1]-e,o=t[0][1]+e),[n,a,r,o]}function $(t,e,n){for(var r,a,o=null,i=G,u=G,s=0;e.length>s;s++)r=j(t[0],t[1],e[s]),a=j(t[1],t[0],e[s]),r>i&&a>u&&!Z([t[0],e[s]],n)&&!Z([t[1],e[s]],n)&&(i=r,u=a,o=e[s]);return o}function B(t,e,n,r){for(var a,o,i,u,s,c=!1,l=0;t.length-1>l;l++)if(F((a=[t[l],t[l+1]])[0],a[1])>=e){o=0,s=O(a,i=N);do{i=(s=r.addBorder2Bbox(s,o))[2]-s[0],u=$(a,r.rangePoints(s),t),o++}while(null===u&&n>i);null!==u&&(t.splice(l+1,0,u),r.removePoint(u),c=!0)}return c?B(t,e,n,r):t}var G=Math.cos(90/(180/Math.PI)),N=5,R=function(t,e){var n,r,a,o,i,u=e||20;return 4>t.length?t:(r=function(t){for(var e=[],n=0;t.length>n;n++){for(;e.length>=2&&0>=k(e[e.length-2],e[e.length-1],t[n]);)e.pop();e.push(t[n])}return e.pop(),e}(t=function(t){return t.sort((function(t,e){return t[0]==e[0]?t[1]-e[1]:t[0]-e[0]}))}(t)),n=function(t){for(var e=t.reverse(),n=[],r=0;e.length>r;r++){for(;n.length>=2&&0>=k(n[n.length-2],n[n.length-1],e[r]);)n.pop();n.push(e[r])}return n.pop(),n}(t),(a=n.concat(r)).push(t[0]),i=.8*Math.max(t[t.length-1][0],function(t){for(var e=-1/0,n=t.length-1;n>=0;n--)t[n][1]>e&&(e=t[n][1]);return e}(a)),o=t.filter((function(t){return 0>a.indexOf(t)})),B(a,Math.pow(u,2),i,new A(o)))},X={};function Y(t,e){return t*t+e*e}function H(t,e,n){var r=e[0],a=e[1],o=n[0]-r,i=n[1]-a;if(0!==o||0!==i){var u=((t[0]-r)*o+(t[1]-a)*i)/Y(o,i);u>1?(r=n[0],a=n[1]):u>0&&(r+=o*u,a+=i*u)}return Y(t[0]-r,t[1]-a)}function z(t,e,n,r,a){for(var o,i=r,u=e+1;n>u;u++){var s=H(t[u],t[e],t[n]);s>i&&(o=u,i=s)}i>r&&(o-e>1&&z(t,e,o,r,a),a.push(t[o]),n-o>1&&z(t,o,n,r,a))}function q(t,e){var n=t.length-1,r=[t[0]];return z(t,0,n,e,r),r.push(t[n]),r}X.__esModule=!0,X.SimplifyAP=function(t,e,n){if(void 0===e&&(e=1),void 0===n&&(n=!1),2>=t.length)return t;var r=e*e;return t=n?t:function(t,e){for(var n,r,a,o=t[0],i=[o],u=1,s=t.length;s>u;u++)Y((r=n=t[u])[0]-(a=o)[0],r[1]-a[1])>e&&(i.push(n),o=n);return o!==n&&i.push(n),i}(t,r),q(t,r)};var W=X.SimplifyAP;function J(t,e,n){return t.level>2&&e>n}onmessage=async function({data:{type:t,data:e}}){let n;switch(t){case"currentWeatherData":n=async function(t,e){return u.search=new URLSearchParams({lat:t.toFixed(3),lon:e.toFixed(3),tz:"Europe/Berlin"}).toString(),function(t){const e=t.weather;return{timestamp:e.timestamp,cloudCover:e.cloud_cover,condition:e.condition,dewPoint:e.dew_point,precipitation:e.precipitation_60,pressureMsl:e.pressure_msl,relativeHumidity:e.relative_humidity,visibility:e.visibility,windDirection:e.wind_direction_10,windSpeed:e.wind_speed_10,windGustDirection:e.wind_gust_direction_10,windGustSpeed:e.wind_gust_speed_10,sunshine:e.sunshine_30,temperature:Math.round(e.temperature),icon:c(e.icon)}}(await(await o(u.toString(),9)).json())}(e.lat,e.lon);break;case"weatherData":n=f(e.lat,e.lon,e.days);break;case"cloudData":n=async function(t,e=!1){let n=(await async function(t,e=!1){return P(await(await o(`https://wettr-service.vercel.app/api/clouds?bounds=${t.lb.lon},${t.rt.lon},${t.lb.lat},${t.rt.lat}${e?"&onlyNow=true":""}`,9)).json())}(t,e)).filter((e=>function({lon:t,lat:e},n){const r=.02;return!(n.lb.lon>t+r||t-r>n.rt.lon||n.lb.lat>e+r||e-r>n.rt.lat)}(e,t))).map((e=>({...e,projected:L(t,e)})));return n.sort(((t,e)=>t.value-e.value)),n=Array.from(new Map(n.map((t=>[`${t.time} ${1e4*t.projected.x|0} ${1e4*t.projected.y|0}`,t]))).values()),{times:function(){const t=new Date(Date.now()-3e5).toISOString(),e=15*(+t.match(/:(\d\d):/)[1]/15|0),n=I(new Date(t.substring(0,13)+":00:00Z"),e);return[...Array(9)].map(((t,e)=>I(n,15*e)))}(),clouds:n,viewBounds:t}}(e.bounds,e.onlyNow);break;case"weatherWarningData":n=async function(){return function(t){const e=Date.now();return function(t){const e=t.slice();return e.sort(((t,e)=>{const n=t.level-e.level;return 0===n?t.time.start.getTime()-e.time.start.getTime():n})),e}(t.warnings.map((t=>{return{event:(n=t.event,n.toLowerCase().replace(/(^|\s)\p{L}/gu,(t=>t.toUpperCase()))),description:t.description,time:{start:new Date(t.start),end:new Date(t.end)},instruction:t.instruction,level:t.level,type:t.type,regions:J(t,t.end,e)?t.regions.map((t=>function(t){const e={lon:100,lat:100},n={lon:0,lat:0},r=[];for(let o=0;t.length/2>o;o+=3)r.push([t[2*o+1],t[2*o]]);const a=W(R(r,.1),.02,!1);for(let o=0;a.length>o;o++){const[t,r]=a[o];e.lon>t?e.lon=t:t>n.lon&&(n.lon=t),e.lat>r?e.lat=r:r>n.lat&&(n.lat=r)}return{polygon:a,bounds:{lb:e,rt:n}}}(t.polygon))):[],urls:t.urls};var n})).filter((t=>J(t,t.time.end,e))))}(await(await o("https://s3.eu-central-1.amazonaws.com/app-prod-static.warnwetter.de/v16/gemeinde_warnings_v2.json",19)).json())}()}postMessage({type:t,data:await n})}}();
