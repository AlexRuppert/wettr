!function(){"use strict";const e={light:"#444444",dark:"#9ca3aa"},t={light:"#0066ED",dark:"#2784FF"},r={light:"#FFB901",dark:"#FFC637"},n=n=>{switch(n){case"rain":case"sleet":case"hail":case"snow":case"thunderstorm":return t;case"clearDay":case"clearNight":case"partlyCloudyDay":case"partlyCloudyNight":return r;default:return e}},a="x--cache-timestamp";async function o(e,t=1e6){let r=await caches.match(e);if(r&&r.headers.get(a)&&+r.headers.get(a)+6e4*t>Date.now())return console.log("cached "+e),r;r=await fetch(e);const n=new Headers(r.headers);n.set(a,Date.now().toString());const o=r.clone(),i=new Response(o.body,{status:o.status,statusText:o.statusText,headers:n});return(await caches.open("v1")).put(e,i),r}const i="https://api.brightsky.dev/";let s=new URL(i+"current_weather"),u=new URL(i+"weather");function l(e){return e.replace(/-\w/g,(e=>e.replace(/-/,"").toUpperCase()))}function c(e=new Date,t=!1){return new Intl.DateTimeFormat("eu").format(e).replace(/\//g,"-")+function(e=new Date,t=!1){return(t?"T23:59:00":"T00:00:00")+((e=new Date)=>{let t=-e.getTimezoneOffset();const r=e=>{const t=Math.floor(Math.abs(e));return(10>t?"0":"")+t};return(0>t?"-":"+")+r(t/60)+":"+r(t%60)})(e)}(e,t)}async function f(e,t,r=3){const a=new Date,i=new Date(a.getTime()+864e5*r-10);u.search=new URLSearchParams({lat:e.toFixed(3),lon:t.toFixed(3),days:r.toString(),date:c(a),last_date:c(i,!0)}).toString();const s=((e,t,r)=>{const a=e.weather.map((e=>({timestamp:e.timestamp,cloudCover:e.cloud_cover,condition:e.condition,dewPoint:e.dew_point,precipitation:e.precipitation,pressureMsl:e.pressure_msl,relativeHumidity:e.relative_humidity,visibility:e.visibility,windDirection:e.wind_direction,windSpeed:e.wind_speed,windGustDirection:e.wind_gust_direction,windGustSpeed:e.wind_gust_speed,sunshine:e.sunshine,temperature:Math.round(e.temperature),icon:l(e.icon)}))),o={};a.forEach((e=>{const t=e.timestamp.split("T")[0];o[t]||(o[t]=[]),o[t].push(e)}));let i={};const s=(e,t,r)=>e>=t&&r>=e,u=e=>{let t=-1/0,r=1/0;e.forEach((e=>{e.temperature>t&&(t=e.temperature),r>e.temperature&&(r=e.temperature)}));const n=t-r;return{min:{temperature:r},max:{temperature:t},dayGraph:e.map((e=>({timestamp:e.timestamp,temperature:0===n?0:Math.abs((e.temperature-r)/n),precipitation:Math.min(Math.pow(1.7*Math.sqrt(e.precipitation),2),6)/6,sunniness:1-e.cloudCover/100})))}};return Object.entries(o).map((([e,a])=>{a=a.map((e=>{return{...e,hours:(t=e.timestamp,new Date(t).getHours())};var t}));const o=new Date(e),l=[],c=[],f=[],d=[],p=((e,t,r)=>{const n=new Date(e.toISOString().substr(0,10)+"T12:00Z");function a(e){return Math.sin(e*(Math.PI/180))}function o(e){return Math.cos(e*(Math.PI/180))}function i(e){return new Date(864e5*(e-2440587.5))}const s=Math.floor(n.getTime()/864e5+2440587.5)-2451545+8e-4-r/360,u=(357.5291+.98560028*s)%360,l=(u+(1.9148*a(u)+.02*a(2*u)+3e-4*a(3*u))+180+102.9372)%360,c=2451545+s+.0053*a(u)-.0069*a(2*l),f=(d=a(l)*a(23.44),Math.asin(d)*(180/Math.PI));var d;const p=(e=>Math.acos(e)*(180/Math.PI))((a(-.83)-a(t)*a(f))/(o(t)*o(f)));return{sunrise:i(c-p/360),sunset:i(c+p/360)}})(o,t,r);return a.forEach((e=>{s(e.hours,4,22)&&l.push(e),s(e.hours,4,9)&&c.push(e),s(e.hours,10,17)&&f.push(e),s(e.hours,18,22)&&d.push(e)})),{day:o,dayLight:p,dayParts:[c,f,d].map((e=>{const t=(i={},e.forEach((e=>{var t;return i[e.icon]=(e=>{switch(e){case"thunderstorm":case"hail":return 12;default:return 1}})(e.icon)+(null!=(t=i[e.icon])?t:0)})),Object.entries(i).reduce(((e,[t,r])=>r>e[1]?[t,r]:e),["clear-day",0])[0].replace("Night","Day"));return{icon:t,colors:n(t)}})),...u(l),data:a}}))})(await(await o(u.toString(),9)).json(),e,t);return s}function d(e,t){var r=e.length;if(r>=t)return e;var n=new Uint8Array(Math.max(r<<1,t));return n.set(e,0),n}function p(e,t,r,n,a,o){for(var i=g,s=_,u=0;r>u;){var l=e[s(n,a)&t];a+=15&l;var c=l>>>4;if(c>15){var f=0,d=0;16==c?(d=3+i(n,a,2),a+=2,f=o[u-1]):17==c?(d=3+i(n,a,3),a+=3):18==c&&(d=11+i(n,a,7),a+=7);for(var p=u+d;p>u;)o[u]=f,u++}else o[u]=c,u++}return a}function h(e,t,r,n){for(var a=0,o=0,i=n.length>>>1;r>o;){var s=e[o+t];n[o<<1]=0,n[1+(o<<1)]=s,s>a&&(a=s),o++}for(;i>o;)n[o<<1]=0,n[1+(o<<1)]=0,o++;return a}function v(e,t){for(var r,n,a,o,i=e.length,s=b.bl_count,u=0;t>=u;u++)s[u]=0;for(u=1;i>u;u+=2)s[e[u]]++;var l=b.next_code;for(r=0,s[0]=0,n=1;t>=n;n++)l[n]=r=r+s[n-1]<<1;for(a=0;i>a;a+=2)0!=(o=e[a+1])&&(e[a]=l[o],l[o]++)}function w(e,t,r){for(var n=e.length,a=b.rev15,o=0;n>o;o+=2)if(0!=e[o+1])for(var i=e[o+1],s=o>>1<<4|i,u=t-i,l=e[o]<<u,c=l+(1<<u);l!=c;)r[a[l]>>>15-t]=s,l++}function m(e,t){for(var r=b.rev15,n=15-t,a=0;e.length>a;a+=2)e[a]=r[e[a]<<t-e[a+1]]>>>n}function g(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<r)-1}function y(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<r)-1}function _(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)}const b=(M=Uint16Array,D=Uint32Array,{next_code:new M(16),bl_count:new M(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new M(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new D(32),flmap:new M(512),fltree:[],fdmap:new M(32),fdtree:[],lmap:new M(32768),ltree:[],ttree:[],dmap:new M(32768),dtree:[],imap:new M(512),itree:[],rev15:new M(32768),lhst:new D(286),dhst:new D(30),ihst:new D(19),lits:new D(15e3),strt:new M(65536),prev:new M(32768)});var M,D;(()=>{for(var e=0;32768>e;e++){var t=e;b.rev15[e]=((t=(4278255360&(t=(4042322160&(t=(3435973836&(t=(2863311530&t)>>>1|(1431655765&t)<<1))>>>2|(858993459&t)<<2))>>>4|(252645135&t)<<4))>>>8|(16711935&t)<<8)>>>16|t<<16)>>>17}function r(e,t,r){for(;0!=t--;)e.push(0,r)}for(e=0;32>e;e++)b.ldef[e]=b.of0[e]<<3|b.exb[e],b.ddef[e]=b.df0[e]<<4|b.dxb[e];r(b.fltree,144,8),r(b.fltree,112,9),r(b.fltree,24,7),r(b.fltree,8,8),v(b.fltree,9),w(b.fltree,9,b.flmap),m(b.fltree,9),r(b.fdtree,32,5),v(b.fdtree,5),w(b.fdtree,5,b.fdmap),m(b.fdtree,5),r(b.itree,19,0),r(b.ltree,286,0),r(b.dtree,30,0),r(b.ttree,320,0)})();const S={table:(()=>{for(var e=new Uint32Array(256),t=0;256>t;t++){for(var r=t,n=0;8>n;n++)1&r?r=3988292384^r>>>1:r>>>=1;e[t]=r}return e})(),update:(e,t,r,n)=>{for(var a=0;n>a;a++)e=S.table[255&(e^t[r+a])]^e>>>8;return e},crc:(e,t,r)=>4294967295^S.update(4294967295,e,t,r)};const C=Math.PI/180;function E(e){return Math.log(Math.tan(x(e)/2+Math.PI/4))}function x(e){return e*C}function L(e,{lon:t,lat:r}){return{x:x(t-e.lb.lon),y:E(r)-E(e.lb.lat)}}function P(e){const t=[];return e.forEach((e=>{const r=e.lon_bucket,n=e.lat_bucket,a=(o=Uint8Array.from(atob(e.data).split("").map((e=>e.charCodeAt(0)))),function(e,t){return((e,t)=>{var r=Uint8Array;if(3==e[0]&&0==e[1])return t||new r(0);var n=y,a=g,o=p,i=_,s=null==t;s&&(t=new r(e.length>>>2<<3));for(var u,l,c=0,f=0,m=0,M=0,D=0,S=0,C=0,E=0,x=0;0==c;)if(c=n(e,x,1),f=n(e,x+1,2),x+=3,0!=f){if(s&&(t=d(t,E+(1<<17))),1==f&&(u=b.flmap,l=b.fdmap,S=511,C=31),2==f){m=a(e,x,5)+257,M=a(e,x+5,5)+1,D=a(e,x+10,4)+4,x+=14;for(var L=0;38>L;L+=2)b.itree[L]=0,b.itree[L+1]=0;var P=1;for(L=0;D>L;L++){var I=a(e,x+3*L,3);b.itree[1+(b.ordr[L]<<1)]=I,I>P&&(P=I)}x+=3*D,v(b.itree,P),w(b.itree,P,b.imap),u=b.lmap,l=b.dmap,x=o(b.imap,(1<<P)-1,m+M,e,x,b.ttree);var U=h(b.ttree,0,m,b.ltree);S=(1<<U)-1;var A=h(b.ttree,m,M,b.dtree);C=(1<<A)-1,v(b.ltree,U),w(b.ltree,U,u),v(b.dtree,A),w(b.dtree,A,l)}for(;;){var T=u[i(e,x)&S];x+=15&T;var k=T>>>4;if(k>>>8==0)t[E++]=k;else{if(256==k)break;var F=E+k-254;if(k>264){var j=b.ldef[k-257];F=E+(j>>>3)+a(e,x,7&j),x+=7&j}var Z=l[i(e,x)&C],O=b.ddef[Z>>>4],$=(O>>>4)+n(e,x+=15&Z,15&O);for(x+=15&O,s&&(t=d(t,E+(1<<17)));F>E;)t[E]=t[E++-$],t[E]=t[E++-$],t[E]=t[E++-$],t[E]=t[E++-$];E=F}}}else{0!=(7&x)&&(x+=8-(7&x));var B=4+(x>>>3),G=e[B-4]|e[B-3]<<8;s&&(t=d(t,E+G)),t.set(new r(e.buffer,e.byteOffset+B,G),E),x=B+G<<3,E+=G}return t.length==E?t:t.slice(0,E)})(e,t)}(new Uint8Array(o.buffer,o.byteOffset+2,o.length-6),undefined));var o;let i=0;for(let s=0;a.length>s;s++){const o=a[s];128&o?i+=-129&o:(t.push({time:e.time,lon:r+i%100/100,lat:n+(i/100|0)/100,value:o/100}),i++)}})),t}function I(e,t){const r=new Date(e);return new Date(r.setMinutes(r.getMinutes()+t))}function U(e,t,r,n,a,o){var i=(o-t)*(r-e)-(n-t)*(a-e);return i>0||i>=0}function A(e){var t=[];e.forEach((function(e){var r=this.point2CellXY(e),n=r[0],a=r[1];void 0===t[n]&&(t[n]=[]),void 0===t[n][a]&&(t[n][a]=[]),t[n][a].push(e)}),this),this.cellPoints=(e,r)=>void 0!==t[e]&&void 0!==t[e][r]?t[e][r]:[],this.removePoint=function(e){for(var r,n=this.point2CellXY(e),a=t[n[0]][n[1]],o=0;a.length>o;o++)if(a[o][0]===e[0]&&a[o][1]===e[1]){r=o;break}return a.splice(r,1),a}}A.prototype={point2CellXY:e=>[parseInt(e[0]/A.CELL_SIZE),parseInt(e[1]/A.CELL_SIZE)],rangePoints:function(e){for(var t=this.point2CellXY([e[0],e[1]]),r=this.point2CellXY([e[2],e[3]]),n=[],a=t[0];r[0]>=a;a++)for(var o=t[1];r[1]>=o;o++)n=n.concat(this.cellPoints(a,o));return n},addBorder2Bbox:(e,t)=>[e[0]-t*A.CELL_SIZE,e[1]-t*A.CELL_SIZE,e[2]+t*A.CELL_SIZE,e[3]+t*A.CELL_SIZE]},A.CELL_SIZE=10;var T=(e,t)=>{var r=e[0][0],n=e[0][1],a=e[1][0],o=e[1][1],i=t[0][0],s=t[0][1],u=t[1][0],l=t[1][1];return U(r,n,i,s,u,l)!==U(a,o,i,s,u,l)&&U(r,n,a,o,i,s)!==U(r,n,a,o,u,l)};function k(e,t,r){return(t[0]-e[0])*(r[1]-e[1])-(t[1]-e[1])*(r[0]-e[0])}function F(e,t){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)}function j(e,t,r){var n=[t[0]-e[0],t[1]-e[1]],a=[r[0]-e[0],r[1]-e[1]],o=F(e,t),i=F(e,r);return(n[0]*a[0]+n[1]*a[1])/Math.sqrt(o*i)}function Z(e,t){for(var r=0;t.length-1>r;r++){var n=[t[r],t[r+1]];if(!(e[0][0]===n[0][0]&&e[0][1]===n[0][1]||e[0][0]===n[1][0]&&e[0][1]===n[1][1])&&T(e,n))return!0}return!1}function O(e,t){var r,n,a,o;return e[1][0]>e[0][0]?(r=e[0][0]-t,n=e[1][0]+t):(r=e[1][0]-t,n=e[0][0]+t),e[1][1]>e[0][1]?(a=e[0][1]-t,o=e[1][1]+t):(a=e[1][1]-t,o=e[0][1]+t),[r,a,n,o]}function $(e,t,r){for(var n,a,o=null,i=G,s=G,u=0;t.length>u;u++)n=j(e[0],e[1],t[u]),a=j(e[1],e[0],t[u]),n>i&&a>s&&!Z([e[0],t[u]],r)&&!Z([e[1],t[u]],r)&&(i=n,s=a,o=t[u]);return o}function B(e,t,r,n){for(var a,o,i,s,u,l=!1,c=0;e.length-1>c;c++)if(F((a=[e[c],e[c+1]])[0],a[1])>=t){o=0,u=O(a,i=N);do{i=(u=n.addBorder2Bbox(u,o))[2]-u[0],s=$(a,n.rangePoints(u),e),o++}while(null===s&&r>i);null!==s&&(e.splice(c+1,0,s),n.removePoint(s),l=!0)}return l?B(e,t,r,n):e}var G=Math.cos(90/(180/Math.PI)),N=5,R={};function X(e,t){return e*e+t*t}function Y(e,t,r){var n=t[0],a=t[1],o=r[0]-n,i=r[1]-a;if(0!==o||0!==i){var s=((e[0]-n)*o+(e[1]-a)*i)/X(o,i);s>1?(n=r[0],a=r[1]):s>0&&(n+=o*s,a+=i*s)}return X(e[0]-n,e[1]-a)}function H(e,t,r,n,a){for(var o,i=n,s=t+1;r>s;s++){var u=Y(e[s],e[t],e[r]);u>i&&(o=s,i=u)}i>n&&(o-t>1&&H(e,t,o,n,a),a.push(e[o]),r-o>1&&H(e,o,r,n,a))}function z(e,t){var r=e.length-1,n=[e[0]];return H(e,0,r,t,n),n.push(e[r]),n}R.__esModule=!0,R.SimplifyAP=(e,t,r)=>{if(void 0===t&&(t=1),void 0===r&&(r=!1),2>=e.length)return e;var n=t*t;return e=r?e:((e,t)=>{for(var r,n,a,o=e[0],i=[o],s=1,u=e.length;u>s;s++)X((n=r=e[s])[0]-(a=o)[0],n[1]-a[1])>t&&(i.push(r),o=r);return o!==r&&i.push(r),i})(e,n),z(e,n)};var q=R.SimplifyAP;async function W(){return(e=>{const t=Date.now();return(e=>{const t=e.slice();return t.sort(((e,t)=>{const r=e.level-t.level;return 0===r?e.time.start.getTime()-t.time.start.getTime():r})),t})(e.warnings.map((e=>{return{event:(r=e.event,r.toLowerCase().replace(/(^|\s)\p{L}/gu,(e=>e.toUpperCase()))),description:e.description,time:{start:new Date(e.start),end:new Date(e.end)},instruction:e.instruction,level:e.level,type:e.type,regions:J(e,e.end,t)?e.regions.map((e=>(e=>{const t={lon:100,lat:100},r={lon:0,lat:0},n=[];for(let d=0;e.length/2>d;d+=3)n.push([e[2*d+1],e[2*d]]);const a=q((f=.1||20,4>(o=n).length?o:(s=(e=>{for(var t=[],r=0;e.length>r;r++){for(;t.length>=2&&0>=k(t[t.length-2],t[t.length-1],e[r]);)t.pop();t.push(e[r])}return t.pop(),t})(o=(e=>e.sort(((e,t)=>e[0]==t[0]?e[1]-t[1]:e[0]-t[0])))(o)),i=(e=>{for(var t=e.reverse(),r=[],n=0;t.length>n;n++){for(;r.length>=2&&0>=k(r[r.length-2],r[r.length-1],t[n]);)r.pop();r.push(t[n])}return r.pop(),r})(o),(u=i.concat(s)).push(o[0]),c=.8*Math.max(o[o.length-1][0],(e=>{for(var t=-1/0,r=e.length-1;r>=0;r--)e[r][1]>t&&(t=e[r][1]);return t})(u)),l=o.filter((e=>0>u.indexOf(e))),B(u,Math.pow(f,2),c,new A(l)))),.02,!1);var o,i,s,u,l,c,f;for(let d=0;a.length>d;d++){const[e,n]=a[d];t.lon>e?t.lon=e:e>r.lon&&(r.lon=e),t.lat>n?t.lat=n:n>r.lat&&(r.lat=n)}return{polygon:a,bounds:{lb:t,rt:r}}})(e.polygon))):[],urls:e.urls};var r})).filter((e=>J(e,e.time.end,t))))})(await(await o("https://s3.eu-central-1.amazonaws.com/app-prod-static.warnwetter.de/v16/gemeinde_warnings_v2.json",19)).json())}function J(e,t,r){return e.level>2&&t>r}onmessage=async({data:{type:e,data:t}})=>{let r;switch(e){case"currentWeatherData":r=async function(e,t){return s.search=new URLSearchParams({lat:e.toFixed(3),lon:t.toFixed(3),tz:"Europe/Berlin"}).toString(),(e=>{const t=e.weather;return{timestamp:t.timestamp,cloudCover:t.cloud_cover,condition:t.condition,dewPoint:t.dew_point,precipitation:t.precipitation_60,pressureMsl:t.pressure_msl,relativeHumidity:t.relative_humidity,visibility:t.visibility,windDirection:t.wind_direction_10,windSpeed:t.wind_speed_10,windGustDirection:t.wind_gust_direction_10,windGustSpeed:t.wind_gust_speed_10,sunshine:t.sunshine_30,temperature:Math.round(t.temperature),icon:l(t.icon)}})(await(await o(s.toString(),9)).json())}(t.lat,t.lon);break;case"weatherData":r=f(t.lat,t.lon,t.days);break;case"cloudData":r=async function(e,t=!1){let r=(await(async(e,t=!1)=>P(await(await o(`https://wettr-service.vercel.app/api/clouds?bounds=${e.lb.lon},${e.rt.lon},${e.lb.lat},${e.rt.lat}${t?"&onlyNow=true":""}`,9)).json()))(e,t)).filter((t=>(({lon:e,lat:t},r)=>{const n=.02;return!(r.lb.lon>e+n||e-n>r.rt.lon||r.lb.lat>t+n||t-n>r.rt.lat)})(t,e))).map((t=>({...t,projected:L(e,t)})));return r.sort(((e,t)=>e.value-t.value)),r=Array.from(new Map(r.map((e=>[`${e.time} ${1e4*e.projected.x|0} ${1e4*e.projected.y|0}`,e]))).values()),{times:(()=>{const e=new Date(Date.now()-3e5).toISOString(),t=15*(+e.match(/:(\d\d):/)[1]/15|0),r=I(new Date(e.substring(0,13)+":00:00Z"),t);return[...Array(9)].map(((e,t)=>I(r,15*t)))})(),clouds:r,viewBounds:e}}(t.bounds,t.onlyNow);break;case"weatherWarningData":r=W()}postMessage({type:e,data:await r})}}();
