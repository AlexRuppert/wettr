!function(){const e="x--cache-timestamp";async function t(t,a=1e6){let n=await caches.match(t);if(n&&n.headers.get(e)&&+n.headers.get(e)+6e4*a>Date.now())return console.log("cached "+t),n;try{n=await fetch(t);const a=new Headers(n.headers);a.set(e,Date.now().toString());const r=n.clone(),i=new Response(r.body,{status:r.status,statusText:r.statusText,headers:a});return(await caches.open("v1")).put(t,i),n}catch(r){return null}}function a(e){switch(e){case"rain":case"sleet":case"hail":case"snow":case"thunderstorm":return"rain";case"clear-day":case"clear-night":case"partly-cloudy-day":case"partly-cloudy-night":return"sun";default:return"other"}}function n({lon:e,lat:t}){return{lon:e.toFixed(3),lat:t.toFixed(3)}}function r(e){let t=e.length;for(;--t>=0;)e[t]=0}r(new Array(576)),r(new Array(60)),r(new Array(512)),r(new Array(256)),r(new Array(29)),r(new Array(30));var i=(e,t,a,n)=>{let r=65535&e,i=e>>>16&65535,s=0;for(;0!==a;){s=a>2e3?2e3:a,a-=s;do{r=r+t[n++]|0,i=i+r|0}while(--s);r%=65521,i%=65521}return r|i<<16};const s=new Uint32Array((()=>{let e,t=[];for(var a=0;256>a;a++){e=a;for(var n=0;8>n;n++)e=1&e?3988292384^e>>>1:e>>>1;t[a]=e}return t})());var o=(e,t,a,n)=>{const r=s,i=n+a;e^=-1;for(let s=n;i>s;s++)e=e>>>8^r[255&(e^t[s])];return~e},c={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},l={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const d=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);let h=1;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(ye){h=0}const f=new Uint8Array(256);for(let ve=0;256>ve;ve++)f[ve]=252>ve?248>ve?240>ve?224>ve?192>ve?1:2:3:4:5:6;f[254]=f[254]=1;var u=(e,t)=>{const a=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let n,r;const i=new Array(2*a);for(r=0,n=0;a>n;){let t=e[n++];if(128>t){i[r++]=t;continue}let s=f[t];if(s>4)i[r++]=65533,n+=s-1;else{for(t&=2===s?31:3===s?15:7;s>1&&a>n;)t=t<<6|63&e[n++],s--;s>1?i[r++]=65533:65536>t?i[r++]=t:(t-=65536,i[r++]=55296|t>>10&1023,i[r++]=56320|1023&t)}}return((e,t)=>{if(65534>t&&e.subarray&&h)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let a="";for(let n=0;t>n;n++)a+=String.fromCharCode(e[n]);return a})(i,r)},w=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let a=t-1;for(;a>=0&&128==(192&e[a]);)a--;return 0>a||0===a?t:a+f[e[a]]>t?a:t},m=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const b=16209;var p=function(e,t){let a,n,r,i,s,o,c,l,d,h,f,u,w,m,p,k,g,_,y,v,x,R,A,E;const D=e.state;a=e.next_in,A=e.input,n=a+(e.avail_in-5),r=e.next_out,E=e.output,i=r-(t-e.avail_out),s=r+(e.avail_out-257),o=D.dmax,c=D.wsize,l=D.whave,d=D.wnext,h=D.window,f=D.hold,u=D.bits,w=D.lencode,m=D.distcode,p=(1<<D.lenbits)-1,k=(1<<D.distbits)-1;e:do{15>u&&(f+=A[a++]<<u,u+=8,f+=A[a++]<<u,u+=8),g=w[f&p];t:for(;;){if(_=g>>>24,f>>>=_,u-=_,_=g>>>16&255,0===_)E[r++]=65535&g;else{if(!(16&_)){if(64&_){if(32&_){D.mode=16191;break e}e.msg="invalid literal/length code",D.mode=b;break e}g=w[(65535&g)+(f&(1<<_)-1)];continue t}for(y=65535&g,_&=15,_&&(_>u&&(f+=A[a++]<<u,u+=8),y+=f&(1<<_)-1,f>>>=_,u-=_),15>u&&(f+=A[a++]<<u,u+=8,f+=A[a++]<<u,u+=8),g=m[f&k];;){if(_=g>>>24,f>>>=_,u-=_,_=g>>>16&255,16&_){if(v=65535&g,_&=15,_>u&&(f+=A[a++]<<u,u+=8,_>u&&(f+=A[a++]<<u,u+=8)),v+=f&(1<<_)-1,v>o){e.msg="invalid distance too far back",D.mode=b;break e}if(f>>>=_,u-=_,_=r-i,v>_){if(_=v-_,_>l&&D.sane){e.msg="invalid distance too far back",D.mode=b;break e}if(x=0,R=h,0===d){if(x+=c-_,y>_){y-=_;do{E[r++]=h[x++]}while(--_);x=r-v,R=E}}else if(_>d){if(x+=c+d-_,_-=d,y>_){y-=_;do{E[r++]=h[x++]}while(--_);if(x=0,y>d){_=d,y-=_;do{E[r++]=h[x++]}while(--_);x=r-v,R=E}}}else if(x+=d-_,y>_){y-=_;do{E[r++]=h[x++]}while(--_);x=r-v,R=E}for(;y>2;)E[r++]=R[x++],E[r++]=R[x++],E[r++]=R[x++],y-=3;y&&(E[r++]=R[x++],y>1&&(E[r++]=R[x++]))}else{x=r-v;do{E[r++]=E[x++],E[r++]=E[x++],E[r++]=E[x++],y-=3}while(y>2);y&&(E[r++]=E[x++],y>1&&(E[r++]=E[x++]))}break}if(64&_){e.msg="invalid distance code",D.mode=b;break e}g=m[(65535&g)+(f&(1<<_)-1)]}}break}}while(n>a&&s>r);y=u>>3,a-=y,u-=y<<3,f&=(1<<u)-1,e.next_in=a,e.next_out=r,e.avail_in=n>a?n-a+5:5-(a-n),e.avail_out=s>r?s-r+257:257-(r-s),D.hold=f,D.bits=u};const k=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),g=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),_=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),y=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var v=(e,t,a,n,r,i,s,o)=>{const c=o.bits;let l,d,h,f,u,w,m=0,b=0,p=0,v=0,x=0,R=0,A=0,E=0,D=0,S=0,U=null;const T=new Uint16Array(16),Z=new Uint16Array(16);let M,B,C,O=null;for(m=0;15>=m;m++)T[m]=0;for(b=0;n>b;b++)T[t[a+b]]++;for(x=c,v=15;v>=1&&0===T[v];v--);if(x>v&&(x=v),0===v)return r[i++]=20971520,r[i++]=20971520,o.bits=1,0;for(p=1;v>p&&0===T[p];p++);for(p>x&&(x=p),E=1,m=1;15>=m;m++)if(E<<=1,E-=T[m],0>E)return-1;if(E>0&&(0===e||1!==v))return-1;for(Z[1]=0,m=1;15>m;m++)Z[m+1]=Z[m]+T[m];for(b=0;n>b;b++)0!==t[a+b]&&(s[Z[t[a+b]]++]=b);if(0===e?(U=O=s,w=20):1===e?(U=k,O=g,w=257):(U=_,O=y,w=0),S=0,b=0,m=p,u=i,R=x,A=0,h=-1,D=1<<x,f=D-1,1===e&&D>852||2===e&&D>592)return 1;for(;;){M=m-A,w>s[b]+1?(B=0,C=s[b]):w>s[b]?(B=96,C=0):(B=O[s[b]-w],C=U[s[b]-w]),l=1<<m-A,d=1<<R,p=d;do{d-=l,r[u+(S>>A)+d]=M<<24|B<<16|C}while(0!==d);for(l=1<<m-1;S&l;)l>>=1;if(0!==l?(S&=l-1,S+=l):S=0,b++,0==--T[m]){if(m===v)break;m=t[a+s[b]]}if(m>x&&(S&f)!==h){for(0===A&&(A=x),u+=p,R=m-A,E=1<<R;v>R+A&&(E-=T[R+A],E>0);)R++,E<<=1;if(D+=1<<R,1===e&&D>852||2===e&&D>592)return 1;h=S&f,r[h]=x<<24|R<<16|u-i}}return 0!==S&&(r[u+S]=m-A<<24|64<<16),o.bits=x,0};const{Z_FINISH:x,Z_BLOCK:R,Z_TREES:A,Z_OK:E,Z_STREAM_END:D,Z_NEED_DICT:S,Z_STREAM_ERROR:U,Z_DATA_ERROR:T,Z_MEM_ERROR:Z,Z_BUF_ERROR:M,Z_DEFLATED:B}=l,C=16180,O=16190,z=16191,I=16192,L=16194,F=16199,j=16200,N=16206,P=16209,H=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function K(){this.strm=null,this.mode=0,this.last=0,this.wrap=0,this.havedict=0,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const G=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||C>t.mode||t.mode>16211?1:0},W=e=>{if(G(e))return U;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,(e=>{if(G(e))return U;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=C,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,E})(e)};let q,J,Q=1;const V=e=>{if(Q){q=new Int32Array(512),J=new Int32Array(32);let t=0;for(;144>t;)e.lens[t++]=8;for(;256>t;)e.lens[t++]=9;for(;280>t;)e.lens[t++]=7;for(;288>t;)e.lens[t++]=8;for(v(1,e.lens,0,288,q,0,e.work,{bits:9}),t=0;32>t;)e.lens[t++]=5;v(2,e.lens,0,32,J,0,e.work,{bits:5}),Q=0}e.lencode=q,e.lenbits=9,e.distcode=J,e.distbits=5},X=(e,t,a,n)=>{let r;const i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),i.wsize>n?(r=i.wsize-i.wnext,r>n&&(r=n),i.window.set(t.subarray(a-n,a-n+r),i.wnext),(n-=r)?(i.window.set(t.subarray(a-n,a),0),i.wnext=n,i.whave=i.wsize):(i.wnext+=r,i.wnext===i.wsize&&(i.wnext=0),i.wsize>i.whave&&(i.whave+=r))):(i.window.set(t.subarray(a-i.wsize,a),0),i.wnext=0,i.whave=i.wsize),0};var Y=W,$=(e,t)=>{let a,n,r,s,c,l,d,h,f,u,w,m,b,k,g,_,y,K,W,q,J,Q,Y=0;const $=new Uint8Array(4);let ee,te;const ae=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(G(e)||!e.output||!e.input&&0!==e.avail_in)return U;a=e.state,a.mode===z&&(a.mode=I),c=e.next_out,r=e.output,d=e.avail_out,s=e.next_in,n=e.input,l=e.avail_in,h=a.hold,f=a.bits,u=l,w=d,Q=E;e:for(;;)switch(a.mode){case C:if(0===a.wrap){a.mode=I;break}for(;16>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}if(2&a.wrap&&35615===h){0===a.wbits&&(a.wbits=15),a.check=0,$[0]=255&h,$[1]=h>>>8&255,a.check=o(a.check,$,2,0),h=0,f=0,a.mode=16181;break}if(a.head&&(a.head.done=0),!(1&a.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",a.mode=P;break}if((15&h)!==B){e.msg="unknown compression method",a.mode=P;break}if(h>>>=4,f-=4,J=8+(15&h),0===a.wbits&&(a.wbits=J),J>15||J>a.wbits){e.msg="invalid window size",a.mode=P;break}a.dmax=1<<a.wbits,a.flags=0,e.adler=a.check=1,a.mode=512&h?16189:z,h=0,f=0;break;case 16181:for(;16>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}if(a.flags=h,(255&a.flags)!==B){e.msg="unknown compression method",a.mode=P;break}if(57344&a.flags){e.msg="unknown header flags set",a.mode=P;break}a.head&&(a.head.text=h>>8&1),512&a.flags&&4&a.wrap&&($[0]=255&h,$[1]=h>>>8&255,a.check=o(a.check,$,2,0)),h=0,f=0,a.mode=16182;case 16182:for(;32>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}a.head&&(a.head.time=h),512&a.flags&&4&a.wrap&&($[0]=255&h,$[1]=h>>>8&255,$[2]=h>>>16&255,$[3]=h>>>24&255,a.check=o(a.check,$,4,0)),h=0,f=0,a.mode=16183;case 16183:for(;16>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}a.head&&(a.head.xflags=255&h,a.head.os=h>>8),512&a.flags&&4&a.wrap&&($[0]=255&h,$[1]=h>>>8&255,a.check=o(a.check,$,2,0)),h=0,f=0,a.mode=16184;case 16184:if(1024&a.flags){for(;16>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}a.length=h,a.head&&(a.head.extra_len=h),512&a.flags&&4&a.wrap&&($[0]=255&h,$[1]=h>>>8&255,a.check=o(a.check,$,2,0)),h=0,f=0}else a.head&&(a.head.extra=null);a.mode=16185;case 16185:if(1024&a.flags&&(m=a.length,m>l&&(m=l),m&&(a.head&&(J=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Uint8Array(a.head.extra_len)),a.head.extra.set(n.subarray(s,s+m),J)),512&a.flags&&4&a.wrap&&(a.check=o(a.check,n,m,s)),l-=m,s+=m,a.length-=m),a.length))break e;a.length=0,a.mode=16186;case 16186:if(2048&a.flags){if(0===l)break e;m=0;do{J=n[s+m++],a.head&&J&&65536>a.length&&(a.head.name+=String.fromCharCode(J))}while(J&&l>m);if(512&a.flags&&4&a.wrap&&(a.check=o(a.check,n,m,s)),l-=m,s+=m,J)break e}else a.head&&(a.head.name=null);a.length=0,a.mode=16187;case 16187:if(4096&a.flags){if(0===l)break e;m=0;do{J=n[s+m++],a.head&&J&&65536>a.length&&(a.head.comment+=String.fromCharCode(J))}while(J&&l>m);if(512&a.flags&&4&a.wrap&&(a.check=o(a.check,n,m,s)),l-=m,s+=m,J)break e}else a.head&&(a.head.comment=null);a.mode=16188;case 16188:if(512&a.flags){for(;16>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}if(4&a.wrap&&h!==(65535&a.check)){e.msg="header crc mismatch",a.mode=P;break}h=0,f=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=1),e.adler=a.check=0,a.mode=z;break;case 16189:for(;32>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}e.adler=a.check=H(h),h=0,f=0,a.mode=O;case O:if(0===a.havedict)return e.next_out=c,e.avail_out=d,e.next_in=s,e.avail_in=l,a.hold=h,a.bits=f,S;e.adler=a.check=1,a.mode=z;case z:if(t===R||t===A)break e;case I:if(a.last){h>>>=7&f,f-=7&f,a.mode=N;break}for(;3>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}switch(a.last=1&h,h>>>=1,f-=1,3&h){case 0:a.mode=16193;break;case 1:if(V(a),a.mode=F,t===A){h>>>=2,f-=2;break e}break;case 2:a.mode=16196;break;case 3:e.msg="invalid block type",a.mode=P}h>>>=2,f-=2;break;case 16193:for(h>>>=7&f,f-=7&f;32>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",a.mode=P;break}if(a.length=65535&h,h=0,f=0,a.mode=L,t===A)break e;case L:a.mode=16195;case 16195:if(m=a.length,m){if(m>l&&(m=l),m>d&&(m=d),0===m)break e;r.set(n.subarray(s,s+m),c),l-=m,s+=m,d-=m,c+=m,a.length-=m;break}a.mode=z;break;case 16196:for(;14>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}if(a.nlen=257+(31&h),h>>>=5,f-=5,a.ndist=1+(31&h),h>>>=5,f-=5,a.ncode=4+(15&h),h>>>=4,f-=4,a.nlen>286||a.ndist>30){e.msg="too many length or distance symbols",a.mode=P;break}a.have=0,a.mode=16197;case 16197:for(;a.ncode>a.have;){for(;3>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}a.lens[ae[a.have++]]=7&h,h>>>=3,f-=3}for(;19>a.have;)a.lens[ae[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,ee={bits:a.lenbits},Q=v(0,a.lens,0,19,a.lencode,0,a.work,ee),a.lenbits=ee.bits,Q){e.msg="invalid code lengths set",a.mode=P;break}a.have=0,a.mode=16198;case 16198:for(;a.nlen+a.ndist>a.have;){for(;Y=a.lencode[h&(1<<a.lenbits)-1],g=Y>>>24,_=Y>>>16&255,y=65535&Y,g>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}if(16>y)h>>>=g,f-=g,a.lens[a.have++]=y;else{if(16===y){for(te=g+2;te>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}if(h>>>=g,f-=g,0===a.have){e.msg="invalid bit length repeat",a.mode=P;break}J=a.lens[a.have-1],m=3+(3&h),h>>>=2,f-=2}else if(17===y){for(te=g+3;te>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}h>>>=g,f-=g,J=0,m=3+(7&h),h>>>=3,f-=3}else{for(te=g+7;te>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}h>>>=g,f-=g,J=0,m=11+(127&h),h>>>=7,f-=7}if(a.have+m>a.nlen+a.ndist){e.msg="invalid bit length repeat",a.mode=P;break}for(;m--;)a.lens[a.have++]=J}}if(a.mode===P)break;if(0===a.lens[256]){e.msg="invalid code -- missing end-of-block",a.mode=P;break}if(a.lenbits=9,ee={bits:a.lenbits},Q=v(1,a.lens,0,a.nlen,a.lencode,0,a.work,ee),a.lenbits=ee.bits,Q){e.msg="invalid literal/lengths set",a.mode=P;break}if(a.distbits=6,a.distcode=a.distdyn,ee={bits:a.distbits},Q=v(2,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,ee),a.distbits=ee.bits,Q){e.msg="invalid distances set",a.mode=P;break}if(a.mode=F,t===A)break e;case F:a.mode=j;case j:if(l>=6&&d>=258){e.next_out=c,e.avail_out=d,e.next_in=s,e.avail_in=l,a.hold=h,a.bits=f,p(e,w),c=e.next_out,r=e.output,d=e.avail_out,s=e.next_in,n=e.input,l=e.avail_in,h=a.hold,f=a.bits,a.mode===z&&(a.back=-1);break}for(a.back=0;Y=a.lencode[h&(1<<a.lenbits)-1],g=Y>>>24,_=Y>>>16&255,y=65535&Y,g>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}if(_&&!(240&_)){for(K=g,W=_,q=y;Y=a.lencode[q+((h&(1<<K+W)-1)>>K)],g=Y>>>24,_=Y>>>16&255,y=65535&Y,K+g>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}h>>>=K,f-=K,a.back+=K}if(h>>>=g,f-=g,a.back+=g,a.length=y,0===_){a.mode=16205;break}if(32&_){a.back=-1,a.mode=z;break}if(64&_){e.msg="invalid literal/length code",a.mode=P;break}a.extra=15&_,a.mode=16201;case 16201:if(a.extra){for(te=a.extra;te>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}a.length+=h&(1<<a.extra)-1,h>>>=a.extra,f-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=16202;case 16202:for(;Y=a.distcode[h&(1<<a.distbits)-1],g=Y>>>24,_=Y>>>16&255,y=65535&Y,g>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}if(!(240&_)){for(K=g,W=_,q=y;Y=a.distcode[q+((h&(1<<K+W)-1)>>K)],g=Y>>>24,_=Y>>>16&255,y=65535&Y,K+g>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}h>>>=K,f-=K,a.back+=K}if(h>>>=g,f-=g,a.back+=g,64&_){e.msg="invalid distance code",a.mode=P;break}a.offset=y,a.extra=15&_,a.mode=16203;case 16203:if(a.extra){for(te=a.extra;te>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}a.offset+=h&(1<<a.extra)-1,h>>>=a.extra,f-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){e.msg="invalid distance too far back",a.mode=P;break}a.mode=16204;case 16204:if(0===d)break e;if(m=w-d,a.offset>m){if(m=a.offset-m,m>a.whave&&a.sane){e.msg="invalid distance too far back",a.mode=P;break}m>a.wnext?(m-=a.wnext,b=a.wsize-m):b=a.wnext-m,m>a.length&&(m=a.length),k=a.window}else k=r,b=c-a.offset,m=a.length;m>d&&(m=d),d-=m,a.length-=m;do{r[c++]=k[b++]}while(--m);0===a.length&&(a.mode=j);break;case 16205:if(0===d)break e;r[c++]=a.length,d--,a.mode=j;break;case N:if(a.wrap){for(;32>f;){if(0===l)break e;l--,h|=n[s++]<<f,f+=8}if(w-=d,e.total_out+=w,a.total+=w,4&a.wrap&&w&&(e.adler=a.check=a.flags?o(a.check,r,w,c-w):i(a.check,r,w,c-w)),w=d,4&a.wrap&&(a.flags?h:H(h))!==a.check){e.msg="incorrect data check",a.mode=P;break}h=0,f=0}a.mode=16207;case 16207:if(a.wrap&&a.flags){for(;32>f;){if(0===l)break e;l--,h+=n[s++]<<f,f+=8}if(4&a.wrap&&h!==(4294967295&a.total)){e.msg="incorrect length check",a.mode=P;break}h=0,f=0}a.mode=16208;case 16208:Q=D;break e;case P:Q=T;break e;case 16210:return Z;default:return U}return e.next_out=c,e.avail_out=d,e.next_in=s,e.avail_in=l,a.hold=h,a.bits=f,(a.wsize||w!==e.avail_out&&P>a.mode&&(N>a.mode||t!==x))&&X(e,e.output,e.next_out,w-e.avail_out),u-=e.avail_in,w-=e.avail_out,e.total_in+=u,e.total_out+=w,a.total+=w,4&a.wrap&&w&&(e.adler=a.check=a.flags?o(a.check,r,w,e.next_out-w):i(a.check,r,w,e.next_out-w)),e.data_type=a.bits+(a.last?64:0)+(a.mode===z?128:0)+(a.mode===F||a.mode===L?256:0),(0===u&&0===w||t===x)&&Q===E&&(Q=M),Q},ee=e=>{if(G(e))return U;let t=e.state;return t.window&&(t.window=null),e.state=null,E},te=(e,t)=>{const a=t.length;let n,r,s;return G(e)?U:(n=e.state,0!==n.wrap&&n.mode!==O?U:n.mode===O&&(r=1,r=i(r,t,a,0),r!==n.check)?T:(s=X(e,t,a,a),s?(n.mode=16210,Z):(n.havedict=1,E)))},ae=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=0};const ne=Object.prototype.toString,{Z_NO_FLUSH:re,Z_FINISH:ie,Z_OK:se,Z_STREAM_END:oe,Z_NEED_DICT:ce,Z_STREAM_ERROR:le,Z_DATA_ERROR:de,Z_MEM_ERROR:he}=l;function fe(e){this.options=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const a=t.shift();if(a){if("object"!=typeof a)throw new TypeError(a+"must be non-object");for(const t in a)d(a,t)&&(e[t]=a[t])}}return e}({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&16>t.windowBits&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),0>t.windowBits||t.windowBits>=16||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&48>t.windowBits&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=0,this.chunks=[],this.strm=new m,this.strm.avail_out=0;let a=((e,t)=>{if(!e)return U;const a=new K;e.state=a,a.strm=e,a.window=null,a.mode=C;const n=((e,t)=>{let a;if(G(e))return U;const n=e.state;return 0>t?(a=0,t=-t):(a=5+(t>>4),48>t&&(t&=15)),t&&(8>t||t>15)?U:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=a,n.wbits=t,W(e))})(e,t);return n!==E&&(e.state=null),n})(this.strm,t.windowBits);if(a!==se)throw new Error(c[a]);if(this.header=new ae,((e,t)=>{if(G(e))return U;const a=e.state;2&a.wrap&&(a.head=t,t.done=0)})(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=(e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,a,n,r,i,s=e.length,o=0;for(r=0;s>r;r++)a=e.charCodeAt(r),55296==(64512&a)&&s>r+1&&(n=e.charCodeAt(r+1),56320==(64512&n)&&(a=65536+(a-55296<<10)+(n-56320),r++)),o+=128>a?1:2048>a?2:65536>a?3:4;for(t=new Uint8Array(o),i=0,r=0;o>i;r++)a=e.charCodeAt(r),55296==(64512&a)&&s>r+1&&(n=e.charCodeAt(r+1),56320==(64512&n)&&(a=65536+(a-55296<<10)+(n-56320),r++)),128>a?t[i++]=a:2048>a?(t[i++]=192|a>>>6,t[i++]=128|63&a):65536>a?(t[i++]=224|a>>>12,t[i++]=128|a>>>6&63,t[i++]=128|63&a):(t[i++]=240|a>>>18,t[i++]=128|a>>>12&63,t[i++]=128|a>>>6&63,t[i++]=128|63&a);return t})(t.dictionary):"[object ArrayBuffer]"===ne.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(a=te(this.strm,t.dictionary),a!==se)))throw new Error(c[a])}fe.prototype.push=function(e,t){const a=this.strm,n=this.options.chunkSize,r=this.options.dictionary;let i,s,o;if(this.ended)return 0;for(s=t===~~t?t:1==t?ie:re,a.input="[object ArrayBuffer]"===ne.call(e)?new Uint8Array(e):e,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(n),a.next_out=0,a.avail_out=n),i=$(a,s),i===ce&&r&&(i=te(a,r),i===se?i=$(a,s):i===de&&(i=ce));a.avail_in>0&&i===oe&&a.state.wrap>0&&0!==e[a.next_in];)Y(a),i=$(a,s);switch(i){case le:case de:case ce:case he:return this.onEnd(i),this.ended=1,0}if(o=a.avail_out,a.next_out&&(0===a.avail_out||i===oe))if("string"===this.options.to){let e=w(a.output,a.next_out),t=a.next_out-e,r=u(a.output,e);a.next_out=t,a.avail_out=n-t,t&&a.output.set(a.output.subarray(e,e+t),0),this.onData(r)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(i!==se||0!==o){if(i===oe)return i=ee(this.strm),this.onEnd(i),this.ended=1,1;if(0===a.avail_in)break}}return 1},fe.prototype.onData=function(e){this.chunks.push(e)},fe.prototype.onEnd=function(e){e===se&&(this.result="string"===this.options.to?this.chunks.join(""):(e=>{let t=0;for(let n=0,r=e.length;r>n;n++)t+=e[n].length;const a=new Uint8Array(t);for(let n=0,r=0,i=e.length;i>n;n++){let t=e[n];a.set(t,r),r+=t.length}return a})(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ue={inflate(e,t){const a=new fe(t);if(a.push(e),a.err)throw a.msg||c[a.err];return a.result}};const{inflate:we}=ue;var me=we;let be=new URL("https://api.brightsky.dev/radar");const pe="https://api.brightsky.dev/";let ke=new URL(pe+"current_weather"),ge=new URL(pe+"weather"),_e=new URL("https://api.brightsky.dev/alerts");onmessage=async function({data:{type:e,data:r}}){let i;switch(e){case"currentWeatherData":i=async function(e){return ke.search=new URLSearchParams({...n(e),tz:"Europe/Berlin"}).toString(),{...(a=await(await t(ke.toString(),9)).json()).weather,precipitation_10:a.weather.precipitation_10??0,precipitation_30:a.weather.precipitation_30??0,precipitation_60:a.weather.precipitation_60??0,temperature:Math.round(a.weather.temperature)};var a}(r);break;case"weatherData":i=async function(e,r=3){const i=new Date,s=new Date(i.getTime()+864e5*r-10);return ge.search=new URLSearchParams({...n(e),date:i.toISOString().split("T")[0],last_date:s.toISOString().split("T")[0],tz:"Europe/Berlin"}).toString(),function(e,t){const n=function(e){const t=[];for(let a=0;e.length>a;a+=24)t.push(e.slice(a,a+24));return t}(e.weather.map((e=>({...e,temperature:Math.round(e.temperature),hours:new Date(e.timestamp).getHours()})))).slice(0,-1),r=n.map((e=>{const n=new Date(e[0].timestamp),r=function(e,t){const a=new Date(e.toISOString().substring(0,10)+"T12:00Z"),n=Math.floor(a.getTime()/864e5+2440587.5)-2451545+8e-4-t.lon/360,r=(357.5291+.98560028*n)%360,i=(r+(1.9148*d(r)+.02*d(2*r)+3e-4*d(3*r))+180+102.9372)%360,s=2451545+n+.0053*d(r)-.0069*d(2*i),o=(c=d(i)*d(23.44),Math.asin(c)*(180/Math.PI));var c;const l=function(e){return Math.acos(e)*(180/Math.PI)}((d(-.83)-d(t.lat)*d(o))/(h(t.lat)*h(o)));function d(e){return Math.sin(e*(Math.PI/180))}function h(e){return Math.cos(e*(Math.PI/180))}function f(e){return new Date(864e5*(e-2440587.5))}return{sunrise:f(s-l/360),sunset:f(s+l/360)}}(n,t),i=function(e){const t=new Map;let a="clear-day",n=0;return e.forEach((e=>{e=e.replace("night","day");const r=(t.get(e)??0)+(e=>/thunderstorm|hail/.test(e)?12:/sleet|snow/.test(e)?5:1)(e);t.set(e,r),r>n&&(n=r,a=e)})),a}(e.filter((e=>{return(t=e.hours)>=7&&21>=t;var t})).map((e=>e.icon))),s=a(i);let{min:o,max:c,dayGraph:l}=function(e){let t=e.map((e=>e.temperature)).sort(((e,t)=>e-t));const[n,r]=[t[0],t[t.length-1]],i=r-n;return{min:{temperature:n},max:{temperature:r},dayGraph:e.map((({timestamp:e,temperature:t,precipitation:r,precipitation_probability:s,cloud_cover:o,wind_speed:c,wind_gust_speed:l,icon:d})=>({timestamp:new Date(e),temperature:t,temperatureFraction:0===i?0:Math.abs((t-n)/i),precipitationFraction:Math.min(Math.min(r,5)+Math.pow((1+s/100)*r*1.4,2),6)/6,sunninessFraction:1-o/100,wind:c,windGust:l,icon:d,iconClass:a(d)})))}}(e);return l=function(e){const t=new Date;function a(e,t,a,n){.1>t[n]&&e[n]>.2&&a[n]>.2&&(t[n]=Math.min(e[n],a[n])+Math.abs(e[n]-a[n])/2)}return e.map(((e,n,r)=>{if(0==n||n==r.length-1||e.timestamp>=t)return e;const i=r[n-1],s=r[n+1];return a(i,e,s,"precipitationFraction"),a(i,e,s,"sunninessFraction"),e}))}(l),{day:n,dayLight:r,daySummary:{icon:i,iconClass:s},min:o,max:c,dayGraph:l,data:e}}));return r}(await(await t(ge.toString(),9)).json(),e)}(r,r.days);break;case"weatherWarningData":i=async function(e){return function({lat:e,lon:t}){return void 0!==e&&void 0!==t&&0!==e&&0!==t&&e>-500}(e)?(_e.search=new URLSearchParams({...n(e)}).toString(),function(e){const t=Date.now();return(e?.alerts??[]).map((e=>{return{event:(n=e.event_de,n.toLowerCase().replace(/(^|\s)\p{L}/gu,(e=>e.toUpperCase()))??""),description:e.description_de??"",time:{start:new Date(e.onset),end:new Date(e.expires)},instruction:e.instruction_de??"",certainty:e.certainty,severity:e.severity,severityRank:(a=e.severety,{minor:1,moderate:2,severe:3,extreme:4}[a]??0),urgency:e.urgency,urgencyRank:(t=e.urgency,{future:1,immediate:2}[t]??0),responseType:e.response_type,category:e.category,type:e.event_code};var t,a,n})).filter((e=>e.time.end>t)).toSorted(function(...e){return(t,a)=>{for(const n of e){const e=n(t,a);if(0!==e)return e}return 0}}(((e,t)=>t.severityRank-e.severityRank),((e,t)=>e.severityRank-t.severityRank),((e,t)=>e.time.start.getTime()-t.time.start.getTime())))}(await(await t(_e,19)).json())):[]}(r);break;case"weatherPrecipitation":i=async function(e){return be.search=new URLSearchParams({...n(e),distance:"27000",tz:"Europe/Berlin"}).toString(),function(e){const t=new Date((new Date).getTime()-9e5);return e.radar.filter((e=>new Date(e.timestamp)>t)).map((t=>{const a=Uint8Array.from(atob(t.precipitation_5),(e=>e.charCodeAt(0)));return{precipitation:new Uint16Array(me(a).buffer),timestamp:t.timestamp,bbox:e.bbox,coordinates:e.geometry?.coordinates}}))}(await(await t(be.toString(),4)).json())}(r)}postMessage({type:e,data:await i})}}();
